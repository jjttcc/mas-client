#!/bin/bash
# vim: expandtab:

iterations=1

if [ $# -gt 0 ]; then iterations=$1; fi
if [ $iterations -lt 1 ]; then exit 0; fi

filter() {
    egrep -v \
'ruby_contracts.*instance.var.*not.init|unused.*var.*\<sc\>|ruby_contracts.*satisfied|warn.*inst.*var.*@.*not.*init'
}

i=1
exit_status=0
time while [ $i -le $iterations ]; do
    ruby --verbose test/test_mas_client.rb --verbose 2>&1|filter
    run_status=$?
    if [ $exit_status == 0 ]; then
        exit_status=$run_status
    fi
    ((++i))
done
if [ $exit_status != 0 ]; then banner FAILED; else banner GOOD; fi
exit $exit_status
